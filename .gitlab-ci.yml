
stages:
    - setup
    - build
    - test

setup_gitlab:
  stage: setup
  script:
    - apt-get update -qy
    - apt-get install -y g++ cmake git
    - apt-get install -y python-pip python-virtualenv

build_coek:
  stage: build
  script:
    - cd ..
    - pwd
    - ls
    - git clone whart222@https://gitlab.com/coopr/coek.git
    - cd coek
    - mkdir build
    - cd build
    - cmake -D with_tests=ON ..
    - make
    - make test_verbose
    - cd ../..

install_poek:
  stage: build
  script:
    - which python
    - python --version
    - virtualenv tmp
    - tmp/bin/python setup.py develop
    - tmp/bin/pip install nose

test_coek:
  stage: test
  script:
    - cd ../coek/build
    - make test_verbose

test_poek:
  stage: test
  script:
    - tmp/bin/nose

